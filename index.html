<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oxygen Powerplay Arena - Rooftop Cricket Turf Booking</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Configuration for custom color classes -->
    <script>
        // Define custom colors used by Tailwind classes to ensure they load correctly
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'arena-cyan': '#06b6d4', // Cyan 500
                        'arena-peak': '#facc15', // Amber 400 (Peak Yellow)
                        'arena-green': '#10b981', // Emerald 500 (Early Bird Green)
                        'arena-late': '#1e3a8a', // Dark Blue for Late Night
                        'arena-dark': '#0f172a', // Slate 900
                        'arena-dark-accent': '#1e293b', // Slate 800
                    },
                },
            },
        };
    </script>
    
    <style>
        /* Custom CSS for a modern, dark, and energetic look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 (arena-dark) */
        }
        
        /* FIX: Use provided image as a full-screen, subtle watermark background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; 
            opacity: 0.05; /* Slightly increased opacity for better visibility of the photo */
            background-repeat: no-repeat;
            background-attachment: fixed; 
            background-position: center center;
            background-size: cover; /* Cover the whole screen */
            background-image: url('https://i.postimg.cc/wjg7PYyz/Whats-App-Image-2025-10-27-at-4-08-37-AM.jpg');
        }

        /* FIX: Ensures the header is more transparent (80% opacity) */
        .header-gradient {
            background-color: rgba(30, 41, 59, 0.8); /* Slate 800 with increased transparency */
            backdrop-filter: blur(5px);
        }
        .arena-gradient-text {
            /* This is the transparent background logo text effect: Cyan to Peak Yellow for high visibility */
            background-image: linear-gradient(to right, #06b6d4, #facc15); /* Changed dark blue to peak yellow for visibility */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .turf-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.5);
        }
        .bg-arena-gradient {
            background-image: linear-gradient(to right, #06b6d4, #1e3a8a);
        }
        /* Custom styles for the Game Setup Winner Dropdown */
        .winner-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3e%3cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.5em;
        }
        /* FIX: Make date picker icon white and visible */
        #booking-date::-webkit-calendar-picker-indicator {
            filter: invert(1); /* Invert the icon color to white */
            opacity: 1;
            cursor: pointer;
        }
        #booking-date {
            color-scheme: dark; /* Enhance visibility on dark mode systems */
        }
    </style>
    
    <script>
        // Removed unused global functions: window.openBookingModal, window.closeBookingModal, etc. 
        // All modal control is now handled via event listeners in setupEventListeners.
        window.closeMenu = () => document.getElementById('mobile-menu').classList.add('hidden');
        window.toggleMobileMenu = () => document.getElementById('mobile-menu').classList.toggle('hidden');
    </script>

    <!-- Load Firebase Modules and Core Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // FIX: Removed setLogLevel from firebase-auth.js import
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // FIX: Added setLogLevel to firebase-firestore.js import
        import { getFirestore, doc, getDoc, addDoc, updateDoc, collection, query, where, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL FIREBASE VARIABLES & SETUP ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // FIX: Handle missing Firebase config on deployment
        const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const firebaseConfig = JSON.parse(firebaseConfigString);
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;

        const PUBLIC_BOOKINGS_PATH = `artifacts/${appId}/public/data/turf_bookings`;
        let currentIntervalId = null; // To store the ID of the running countdown timer

        const pricing = {
            'weekday': {
                'early': 399,   // 06:00 - 16:00
                'peak': 699,    // 16:00 - 23:00
                'late': 799     // 23:00 - 06:00 (Late Night/Early Bird)
            },
            'weekend': {
                'early': 599,   // 06:00 - 16:00
                'peak': 899,    // 16:00 - 23:00
                'late': 899     // 23:00 - 06:00 (Late Night/Early Bird)
            }
        };

        /**
         * Initializes Firebase and sets up authentication.
         */
        async function initializeFirebase() {
            if (db) return; // Prevent double initialization
            console.log("Starting Firebase Initialization...");
            try {
                // FIX: Add validation check for deployment
                if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
                    console.error("Firebase config is missing or invalid!");
                    throw new Error("Firebase configuration is missing or invalid. Cannot connect to the database.");
                }

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug'); // Enable detailed Firestore logging

                onAuthStateChanged(auth, async (user) => {
                    console.log("Auth state changed. User:", user ? user.uid : "None");
                    if (user) {
                        userId = user.uid;
                    } else if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        userId = auth.currentUser.uid;
                    } else {
                        await signInAnonymously(auth);
                        userId = auth.currentUser.uid;
                    }
                    isAuthReady = true;
                    console.log("Firebase Auth Ready. User ID:", userId);
                    
                    // Set booking date minimum to today's date
                    const today = new Date().toISOString().substring(0, 10);
                    const bookingDateInput = document.getElementById('booking-date');
                    if (bookingDateInput) {
                        bookingDateInput.value = today;
                        bookingDateInput.min = today;
                    }
                    // Initial load of slots after auth is ready
                    console.log("Calling renderTimeSlots for the first time.");
                    renderTimeSlots(today);
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showNotification("Error initializing database.", "error");

                // FIX: Show a user-facing error in the slot grid.
                const timeSlotsGrid = document.getElementById('time-slots-grid');
                if (timeSlotsGrid) {
                    timeSlotsGrid.innerHTML = `<div class="col-span-full text-center text-red-500 font-bold p-4">Error: Cannot load booking system. Database connection failed.</div>`;
                }
            }
        }

        /**
         * Toggles body scroll lock when modal is open/closed.
         */
        function toggleScrollLock(isOpen) {
            document.body.classList.toggle('overflow-hidden', isOpen);
        }

        /**
         * Helper to show notifications.
         */
        function showNotification(message, type) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            // Using the custom classes here
            const bgColor = type === 'success' ? 'bg-arena-green' : 'bg-red-600'; 
            notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white z-50 transition-transform transform ${bgColor} translate-y-full`;
            notification.textContent = message;
            container.appendChild(notification);

            // Animate in
            setTimeout(() => notification.style.transform = 'translateY(0)', 10);

            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateY(100%)';
                notification.addEventListener('transitionend', () => notification.remove());
            }, 5000);
        }

        /**
         * Calculates price for a specific hour.
         */
        function getPrice(dayType, hour) {
            if (hour >= 6 && hour < 16) {
                return pricing[dayType].early;
            } else if (hour >= 16 && hour < 23) {
                return pricing[dayType].peak;
            } else { // 23:00 to 05:00
                return pricing[dayType].late;
            }
        }

        /**
         * Real-time timer logic for IN PLAY slots and 5-minute reminder.
         */
        function updateCurrentStatus(bookingDate, bookedSlots) {
            try {
                if (currentIntervalId) clearInterval(currentIntervalId);

                const now = new Date();
                const todayISO = now.toISOString().substring(0, 10);
                if (bookingDate !== todayISO) return;

                currentIntervalId = setInterval(() => {
                    const innerNow = new Date();
                    const innerCurrentHour = innerNow.getHours();
                    const slotElement = document.getElementById(`slot-${innerCurrentHour}`);

                    // Check if the current hour is booked in the fetched data
                    const isBooked = bookedSlots.includes(innerCurrentHour);

                    if (slotElement) {
                        const timeLabel = slotElement.getAttribute('data-time-label');

                        // Logic for a slot currently in play and booked
                        if (isBooked) {
                            const hourEnd = new Date(innerNow);
                            hourEnd.setHours(innerCurrentHour + 1, 0, 0, 0);

                            const timeRemaining = Math.floor((hourEnd.getTime() - innerNow.getTime()) / 1000);

                            if (timeRemaining > 0) {
                                const minutesRemaining = Math.floor(timeRemaining / 60);
                                const secondsRemaining = timeRemaining % 60;
                                const timerText = `${String(minutesRemaining).padStart(2, '0')}:${String(secondsRemaining).padStart(2, '0')}`;

                                let statusText;
                                let newClasses = ['text-white', 'border-red-600', 'cursor-not-allowed'];
                                let removeClasses = ['bg-red-700', 'bg-red-900/50', 'animate-pulse'];

                                // 5-Minute Reminder Logic
                                if (timeRemaining <= 300) {
                                    statusText = `ߚ FINISH IN ${timerText}!`;
                                    newClasses.push('bg-red-700', 'animate-pulse');
                                    removeClasses.push('bg-red-900/50');
                                } else {
                                    statusText = `IN PLAY (${timerText})`;
                                    newClasses.push('bg-red-900/50');
                                    removeClasses.push('bg-red-700', 'animate-pulse');
                                }

                                slotElement.classList.remove(...removeClasses.filter(c => slotElement.classList.contains(c)));
                                slotElement.classList.add(...newClasses);
                                slotElement.innerHTML = `<span class="text-xs font-light">${timeLabel}</span><span class="font-bold text-sm">${statusText}</span>`;
                                slotElement.setAttribute('data-status', 'in-play');

                            } else {
                                // Slot has officially ended, refresh the whole grid
                                clearInterval(currentIntervalId);
                                renderTimeSlots(bookingDate);
                                return; 
                            }
                        }
                    }

                    // Handle previous hour slot transitioning to PAST
                    const pastHour = (innerCurrentHour - 1 + 24) % 24;
                    const pastSlotElement = document.getElementById(`slot-${pastHour}`);

                    // Only update the past slot if the hour has changed and it wasn't marked past already
                    if (pastSlotElement && innerNow.getHours() === innerCurrentHour && innerNow.getMinutes() === 0 && innerNow.getSeconds() < 2) { 
                         if (pastSlotElement.getAttribute('data-status') !== 'past') {
                            pastSlotElement.innerHTML = `<span class="text-xs font-light">${String(pastHour).padStart(2, '0')}:00 - ${String(innerCurrentHour).padStart(2, '0')}:00</span><span class="font-bold text-sm">PAST</span>`;
                            pastSlotElement.classList.add('bg-gray-800', 'line-through', 'cursor-not-allowed');
                            pastSlotElement.classList.remove('bg-red-900/50', 'bg-red-700', 'animate-pulse');
                            pastSlotElement.setAttribute('data-status', 'past');
                         }
                    }

                }, 1000);
            } catch (e) {
                console.error("Error in updateCurrentStatus:", e);
                if (currentIntervalId) clearInterval(currentIntervalId);
            }
        }


        /**
         * Renders the 24-hour time slot grid for a given date, fetching real-time availability.
         */
        async function renderTimeSlots(dateString) {
            console.log(`renderTimeSlots called for date: ${dateString}`);
            const timeSlotsGrid = document.getElementById('time-slots-grid');
            if (!timeSlotsGrid) {
                console.error("Slot grid element not found!");
                return;
            }

            // Check if Firebase is ready. If not, show loading and return.
            if (!isAuthReady || !db) {
                console.warn("renderTimeSlots called, but Firebase is not ready.");
                // Ensure loading message is visible if called too early
                timeSlotsGrid.innerHTML = `<div class="col-span-full text-center text-arena-cyan font-bold p-4">Initializing Booking System...</div>`;
                return;
            }
            
            // Show loading message while fetching data
            timeSlotsGrid.innerHTML = `<div class="col-span-full text-center text-arena-cyan font-bold p-4">Checking Availability...</div>`;

            try {
                if (currentIntervalId) clearInterval(currentIntervalId);
                
                const selectedDate = new Date(dateString);
                const isWeekend = selectedDate.getDay() === 0 || selectedDate.getDay() === 6; // Sunday is 0, Saturday is 6
                const dayType = isWeekend ? 'weekend' : 'weekday';

                // Fetch current bookings for the selected date
                console.log(`Fetching bookings from: ${PUBLIC_BOOKINGS_PATH} for date: ${dateString}`);
                const bookingsRef = collection(db, PUBLIC_BOOKINGS_PATH);
                const q = query(bookingsRef, where("date", "==", dateString));
                const querySnapshot = await getDocs(q);
                console.log(`Found ${querySnapshot.size} bookings for this date.`);

                let bookedHours = [];
                querySnapshot.forEach((doc) => {
                    const booking = doc.data();
                    if (booking.slots) {
                        bookedHours.push(...booking.slots);
                    }
                });
                
                bookedHours = [...new Set(bookedHours)].sort((a, b) => a - b);
                
                let htmlContent = '';
                const now = new Date();
                const todayISO = now.toISOString().substring(0, 10);
                const currentHour = now.getHours();

                for (let h = 0; h < 24; h++) {
                    const isBooked = bookedHours.includes(h);
                    const timeLabel = `${String(h).padStart(2, '0')}:00 - ${String((h + 1) % 24).padStart(2, '0')}:00`;
                    const price = getPrice(dayType, h);
                    let classes = ['turf-slot', 'flex flex-col', 'items-center', 'justify-center', 'p-3', 'rounded-lg', 'shadow-md', 'text-white', 'font-semibold', 'transition-all', 'duration-150', 'cursor-pointer', 'border-2', 'border-transparent'];
                    let content;
                    let status = 'available';

                    // Determine base styling (Peak, Early, Late)
                    if (price === pricing[dayType].peak) {
                        classes.push('bg-arena-peak/20', 'hover:bg-arena-peak/40'); // Peak Yellow
                    } else if (price === pricing[dayType].early) {
                        classes.push('bg-arena-green/20', 'hover:bg-arena-green/40'); // Early Green
                    } else {
                        classes.push('bg-arena-late/20', 'hover:bg-arena-late/40'); // Late Blue
                    }

                    // Determine actual status (Past, Booked, Available)
                    if (dateString === todayISO && h < currentHour) {
                        // Past hour on the current day
                        classes.push('bg-gray-800', 'line-through', 'cursor-not-allowed', 'opacity-60');
                        content = `<span class="text-xs font-light">${timeLabel}</span><span class="font-bold text-sm">PAST</span>`;
                        status = 'past';
                    } else if (isBooked) {
                        // Hour is booked (or in play)
                        classes.push('bg-red-900/50', 'text-white', 'cursor-not-allowed', 'border-red-600');
                        content = `<span class="text-xs font-light">${timeLabel}</span><span class="font-bold text-sm">BOOKED</span>`;
                        status = 'booked';
                    } else {
                        // Available hour
                        classes.push('selectable-slot', 'hover:border-arena-cyan');
                        content = `<span class="text-xs font-light">${timeLabel}</span><span class="font-bold text-lg">${price}/-</span>`;
                    }
                    
                    htmlContent += `
                        <div id="slot-${h}" 
                            class="${classes.join(' ')}" 
                            data-hour="${h}" 
                            data-price="${price}" 
                            data-status="${status}" 
                            data-time-label="${timeLabel}"
                            onclick="${status === 'available' ? 'toggleSlotSelection(this)' : ''}">
                            ${content}
                        </div>
                    `;
                }
                
                timeSlotsGrid.innerHTML = htmlContent;
                console.log("Slot grid rendered successfully.");

                // Start the countdown timer if today's bookings are being viewed
                updateCurrentStatus(dateString, bookedHours);
                
                // Reset cost display
                document.getElementById('total-cost').textContent = '0/-';
                document.getElementById('booking-error-msg').textContent = '';

            } catch (error) {
                console.error("Error rendering time slots:", error);
                timeSlotsGrid.innerHTML = `<div class="col-span-full text-center text-red-500 font-bold p-4">Error loading slots. Please check connection and refresh.</div>`;
            }
        }


        /**
         * Handles the selection/deselection of time slots and updates the total cost.
         */
        window.selectedHours = [];
        function toggleSlotSelection(element) {
            try {
                const hour = parseInt(element.getAttribute('data-hour'));
                const price = parseInt(element.getAttribute('data-price'));
                const isSelected = element.classList.contains('bg-arena-cyan');
                
                if (isSelected) {
                    // Deselect
                    element.classList.remove('bg-arena-cyan', 'border-white');
                    selectedHours = selectedHours.filter(h => h !== hour);
                } else {
                    // Select
                    element.classList.add('bg-arena-cyan', 'border-white');
                    selectedHours.push(hour);
                }
                
                selectedHours.sort((a, b) => a - b);
                updateTotalCost();
            } catch (e) {
                console.error("Error toggling slot selection:", e);
                showNotification("Error updating selection.", "error");
            }
        }

        /**
         * Calculates and updates the total booking cost.
         */
        function updateTotalCost() {
            const totalCostEl = document.getElementById('total-cost');
            const errorMsgEl = document.getElementById('booking-error-msg');
            let total = 0;
            let lateNightCount = 0;
            
            errorMsgEl.textContent = '';
            
            if (selectedHours.length === 0) {
                totalCostEl.textContent = '0/-';
                return;
            }

            const isWeekend = new Date(document.getElementById('booking-date').value).getDay() === 0 || new Date(document.getElementById('booking-date').value).getDay() === 6;
            const dayType = isWeekend ? 'weekend' : 'weekday';

            selectedHours.forEach(hour => {
                const price = getPrice(dayType, hour);
                total += price;

                // Check for Late Night hours (23, 0, 1, 2, 3, 4, 5)
                if (hour >= 23 || hour < 6) {
                    lateNightCount++;
                }
            });

            // Minimum 2-hour booking validation for Late Night/Early Bird slots (23:00 - 05:00)
            if (selectedHours.some(h => h >= 23 || h < 6) && selectedHours.length < 2) {
                 errorMsgEl.textContent = "Late Night/Early Bird slots (11PM - 6AM) require a minimum 2-hour booking.";
                 totalCostEl.textContent = '---';
                 return;
            }


            // Check for continuous slots (important for turf booking)
            for (let i = 0; i < selectedHours.length - 1; i++) {
                if (selectedHours[i+1] !== selectedHours[i] + 1) {
                    errorMsgEl.textContent = "Booking must consist of continuous hourly slots.";
                    totalCostEl.textContent = '---';
                    return;
                }
            }
            
            totalCostEl.textContent = `${total}/-`;
        }

        /**
         * Resets all selected slots in the UI without triggering a click handler.
         */
        function resetSelectedSlots() {
            document.querySelectorAll('.selectable-slot').forEach(el => {
                el.classList.remove('bg-arena-cyan', 'border-white');
            });
            selectedHours = [];
            document.getElementById('total-cost').textContent = '0/-';
        }

        /**
         * Shows the payment screen (simulating UPI/QR payment).
         */
        function showPaymentScreen(bookingId, totalCost) {
            // Hide form and success views
            document.getElementById('booking-form-view').classList.add('hidden');
            document.getElementById('booking-success-view').classList.add('hidden');
            
            // Populate payment view
            document.getElementById('payment-booking-id').textContent = bookingId;
            document.getElementById('payment-total-cost').textContent = `${totalCost}/-`;
            
            // Generate mock UPI deep link
            const upiLink = `upi://pay?pa=oxygenarena@upi&pn=Oxygen%20Arena&am=${totalCost}&cu=INR&tn=Booking%20ID%20${bookingId}`;
            document.getElementById('upi-deep-link').href = upiLink;
            document.getElementById('payment-amount-display').textContent = totalCost; // For mobile button
            
            // Show payment screen
            document.getElementById('booking-payment-view').classList.remove('hidden');
        }

        /**
         * Shows the central confirmation screen after a successful booking.
         */
        function showBookingSuccess(bookingId, totalCost) {
            // Reset the form just in case, before showing success
            document.getElementById('booking-form').reset();
            resetSelectedSlots();
            
            // Populate the success view
            document.getElementById('success-booking-id').textContent = bookingId;
            document.getElementById('success-total-cost').textContent = `${totalCost}/-`;

            // Toggle visibility
            document.getElementById('booking-form-view').classList.add('hidden');
            document.getElementById('booking-payment-view').classList.add('hidden'); // Ensure payment is hidden
            document.getElementById('booking-success-view').classList.remove('hidden');
        }

        /**
         * Handles the final submission of the booking form.
         */
        async function submitBooking(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('full-name').value;
            const phoneNumber = document.getElementById('phone-number').value;
            const date = document.getElementById('booking-date').value;
            const errorMsgEl = document.getElementById('booking-error-msg');
            
            if (!fullName || !phoneNumber || selectedHours.length === 0) {
                errorMsgEl.textContent = 'Please fill out all fields and select at least one time slot.';
                return;
            }

            // Re-validate cost before final submission
            updateTotalCost();
            const totalCostEl = document.getElementById('total-cost');
            if (errorMsgEl.textContent && errorMsgEl.textContent !== '---') { // Check if updateCost set a validation error
                 showNotification("Booking rejected: Please fix errors in time slot selection.", "error");
                 return;
            }
            
            const totalCost = totalCostEl.textContent.replace('/-', '');

            const bookingData = {
                userId: userId,
                date: date,
                slots: selectedHours,
                fullName: fullName,
                phoneNumber: phoneNumber,
                cost: parseInt(totalCost),
                timestamp: new Date(),
                status: 'Payment Pending' // STATUS UPDATED: Payment Pending
            };

            try {
                const docRef = await addDoc(collection(db, PUBLIC_BOOKINGS_PATH), bookingData);
                
                // NEW: Display the payment prompt
                showPaymentScreen(docRef.id, totalCost);
                
            } catch (e) {
                console.error("Error adding document: ", e);
                showNotification("Booking failed. Please try again.", "error");
            }
        }

        // --- GAME SETUP / SCORECARD LOGIC ---

        /**
         * Handles the initial submission of the Booking ID to start Game Setup.
         */
        async function handleGameSetup(event) {
            try {
                event.preventDefault();
                const bookingIdInput = document.getElementById('booking-id-input');
                const bookingId = bookingIdInput.value.trim();

                if (!bookingId) {
                    document.getElementById('game-error-msg').textContent = "Please enter a valid Booking ID.";
                    return;
                }
                
                document.getElementById('game-error-msg').textContent = "Loading...";

                const docRef = doc(db, PUBLIC_BOOKINGS_PATH, bookingId);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    document.getElementById('game-error-msg').textContent = "Booking ID not found.";
                    return;
                }

                const booking = docSnap.data();
                document.getElementById('game-error-msg').textContent = '';
                
                // FIX: Hide the Booking ID entry form to show the content
                document.getElementById('booking-id-entry-container').classList.add('hidden');

                // Store active booking data on the modal itself for later reference
                const modal = document.getElementById('game-setup-modal');
                modal.setAttribute('data-active-booking-id', bookingId);
                modal.setAttribute('data-active-booking-date', booking.date);
                modal.setAttribute('data-active-booking-slots', JSON.stringify(booking.slots));
                
                // Proceed to team name entry/submission
                renderGameSetup(booking);

            } catch (e) {
                console.error("Error fetching booking for setup:", e);
                document.getElementById('game-error-msg').textContent = "An error occurred fetching booking details.";
            }
        }

        /**
         * Renders the team name form or the winner selection form based on booking status.
         */
        function renderGameSetup(booking) {
            const setupContent = document.getElementById('game-setup-content');
            const isTeamSetup = !!booking.teamA && !!booking.teamB;
            
            // Clear any previous dynamic content
            setupContent.innerHTML = '';

            let html = '';

            if (!isTeamSetup) {
                // Team Name Entry Form
                html = `
                    <h3 class="text-xl font-bold text-white mb-4">Set Team Names for Match</h3>
                    <p class="text-gray-400 mb-6">Booking ID: <span class="text-arena-cyan font-mono">${document.getElementById('game-setup-modal').getAttribute('data-active-booking-id')}</span></p>
                    <form id="team-name-form" class="space-y-4">
                        <div>
                            <label for="team-a-name" class="block text-gray-400 font-medium">Team A Name</label>
                            <input type="text" id="team-a-name" class="w-full p-3 mt-1 bg-arena-dark-accent border border-gray-600 rounded-lg text-white placeholder-gray-500" placeholder="e.g., The Pitch Blinders" required>
                        </div>
                        <div>
                            <label for="team-b-name" class="block text-gray-400 font-medium">Team B Name</label>
                            <input type="text" id="team-b-name" class="w-full p-3 mt-1 bg-arena-dark-accent border border-gray-600 rounded-lg text-white placeholder-gray-500" placeholder="e.g., The Turf Titans" required>
                        </div>
                        <button type="submit" class="w-full py-3 mt-4 text-lg font-bold text-white rounded-lg bg-arena-gradient hover:opacity-90 transition-opacity">
                            Start Match!
                        </button>
                    </form>
                `;
            } else {
                // Winner Submission Form
                html = `
                    <h3 class="text-xl font-bold text-white mb-2">Match Report</h3>
                    <p class="text-gray-400 mb-6">
                        <span class="text-arena-cyan font-bold">${booking.teamA}</span> vs <span class="text-arena-cyan font-bold">${booking.teamB}</span>
                    </p>
                    <p class="text-sm text-red-400 mb-4">You can only submit the winner after your booked time slot ends.</p>
                    
                    <form id="winner-form" class="space-y-4">
                        <div>
                            <label for="winner-select" class="block text-gray-400 font-medium mb-2">Select Winning Team</label>
                            <select id="winner-select" class="winner-select w-full p-3 mt-1 bg-arena-dark-accent border border-gray-600 rounded-lg text-white" required>
                                <option value="" disabled selected>-- Choose Winner --</option>
                                <option value="${booking.teamA}">${booking.teamA}</option>
                                <option value="${booking.teamB}">${booking.teamB}</option>
                                <option value="Draw">Draw</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full py-3 mt-4 text-lg font-bold text-white rounded-lg bg-red-600 hover:bg-red-700 transition-colors">
                            Submit Winner & Share
                        </button>
                    </form>
                `;
            }

            setupContent.innerHTML = html;

            // Attach listeners to the dynamically created forms
            if (!isTeamSetup) {
                document.getElementById('team-name-form').addEventListener('submit', (e) => submitTeamNames(e, booking));
            } else {
                document.getElementById('winner-form').addEventListener('submit', submitWinner);
            }
        }

        /**
         * Submits the initial team names to Firestore.
         */
        async function submitTeamNames(event, booking) {
            try {
                event.preventDefault();
                const bookingId = document.getElementById('game-setup-modal').getAttribute('data-active-booking-id');
                const teamA = document.getElementById('team-a-name').value;
                const teamB = document.getElementById('team-b-name').value;

                if (!teamA || !teamB) return;

                const docRef = doc(db, PUBLIC_BOOKINGS_PATH, bookingId);
                await updateDoc(docRef, {
                    teamA: teamA,
                    teamB: teamB,
                    matchSetupTimestamp: new Date()
                });

                showNotification("Team names saved! Good luck!", "success");

                // Immediately transition to the winner selection screen
                booking.teamA = teamA;
                booking.teamB = teamB;
                renderGameSetup(booking);

            } catch (e) {
                console.error("Error submitting team names:", e);
                document.getElementById('game-error-msg').textContent = "Error saving names. Try again.";
            }
        }

        /**
         * Submits the match winner and triggers a social share link.
         */
        async function submitWinner(event) {
            try {
                event.preventDefault();
                const bookingId = document.getElementById('game-setup-modal').getAttribute('data-active-booking-id');
                const winner = document.getElementById('winner-select').value;
                const winnerSelectEl = document.getElementById('winner-select');

                if (!winner) {
                    document.getElementById('game-error-msg').textContent = "Please select a winner.";
                    return;
                }
                
                // Disable the form/dropdown after selection
                winnerSelectEl.disabled = true;
                
                const docRef = doc(db, PUBLIC_BOOKINGS_PATH, bookingId);
                await updateDoc(docRef, {
                    winner: winner,
                    matchEndTimestamp: new Date(),
                    status: 'Completed'
                });

                showNotification(`Match Result Saved! Winner: ${winner}`, "success");
                
                // Generate WhatsApp Share Link
                const teamA = winnerSelectEl.querySelector(`option[value="${winnerSelectEl.options[1].value}"]`).textContent;
                const teamB = winnerSelectEl.querySelector(`option[value="${winnerSelectEl.options[2].value}"]`).textContent;
                
                const shareText = encodeURIComponent(
                    `ߎ MATCH RESULT @ Oxygen Powerplay Arena! ߎ\n\n` +
                    `${teamA} vs ${teamB}\n` +
                    `ߥ WINNER: ${winner}\n\n` +
                    `Book your next match: (9019467717)`
                );
                
                // Open WhatsApp link (using the provided number)
                window.open(`https://wa.me/919019467717?text=${shareText}`, '_blank');
                
                // Close modal using event listener approach
                document.getElementById('game-setup-modal').classList.add('hidden');
                toggleScrollLock(false);

            } catch (e) {
                console.error("Error submitting winner:", e);
                document.getElementById('game-error-msg').textContent = "Error submitting winner.";
            }
        }

        /**
         * Resets the booking view to the form and clears data.
         */
        function resetBookingModalView() {
            document.getElementById('booking-form-view').classList.remove('hidden');
            // NEW: Ensure payment view is hidden on reset
            document.getElementById('booking-payment-view').classList.add('hidden');
            document.getElementById('booking-success-view').classList.add('hidden');
            document.getElementById('booking-form').reset();
            resetSelectedSlots();
        }

        /**
         * Clears intervals and resets UI elements when modals close.
         */
        function cleanupModal() {
            if (currentIntervalId) clearInterval(currentIntervalId);
            const bookingDateInput = document.getElementById('booking-date');
            if (bookingDateInput && bookingDateInput.value) {
                // Re-render slots for the *currently selected* date to clear any 'IN PLAY' timers
                renderTimeSlots(bookingDateInput.value); 
            }
            resetBookingModalView(); // Ensure booking modal is reset
            
            // Reset game setup modal
            document.getElementById('game-error-msg').textContent = '';
            document.getElementById('booking-id-input').value = '';
            document.getElementById('booking-id-entry-container')?.classList.remove('hidden');
            document.getElementById('game-setup-content').innerHTML = '';
        }

        /**
         * Setup Event Listeners
         */
        function setupEventListeners() {
            try {
                document.getElementById('booking-form')?.addEventListener('submit', submitBooking);
                document.getElementById('game-setup-form')?.addEventListener('submit', handleGameSetup);
                document.getElementById('booking-date')?.addEventListener('change', (e) => renderTimeSlots(e.target.value));

                // NEW: Listener for Payment Done button
                document.getElementById('payment-done-btn')?.addEventListener('click', () => { 
                    const bookingId = document.getElementById('payment-booking-id').textContent;
                    const totalCostText = document.getElementById('payment-total-cost').textContent;
                    const totalCost = totalCostText.replace('/-', '');
                    
                    // Simulating the backend confirming payment, now show success
                    showBookingSuccess(bookingId, totalCost);
                    showNotification("Payment confirmed! Your match is officially booked.", "success");
                });


                // Function to handle opening the booking modal
                const handleOpenBooking = (closeMobileMenu = false) => {
                    document.getElementById('booking-modal').classList.remove('hidden');
                    toggleScrollLock(true);
                    if (closeMobileMenu) {
                        document.getElementById('mobile-menu').classList.add('hidden');
                    }
                    // Ensure form view is displayed when opening
                    resetBookingModalView();
                    
                    // Explicitly re-render slots when modal is opened
                    // to ensure they are fresh
                    const bookingDateInput = document.getElementById('booking-date');
                    if (bookingDateInput && bookingDateInput.value) {
                         renderTimeSlots(bookingDateInput.value);
                    }
                };
                
                // --- Modal Control Listeners (Fixed duplicate ID issue) ---
                
                // 1. Desktop Nav Button (original ID)
                document.getElementById('open-booking-btn')?.addEventListener('click', () => handleOpenBooking()); 
                
                // 2. Hero Section Button (new unique ID)
                document.getElementById('open-booking-btn-hero')?.addEventListener('click', () => handleOpenBooking()); 
                
                // 3. Mobile Nav Button (listener added, inline onclick removed)
                document.getElementById('open-booking-btn-mobile')?.addEventListener('click', () => handleOpenBooking(true)); 

                document.getElementById('close-booking-btn')?.addEventListener('click', () => { 
                    document.getElementById('booking-modal').classList.add('hidden');
                    toggleScrollLock(false);
                    cleanupModal();
                });

                // Listener for the new close button on the success screen
                document.getElementById('close-success-btn')?.addEventListener('click', () => {
                    document.getElementById('booking-modal').classList.add('hidden');
                    toggleScrollLock(false);
                    cleanupModal(); // Will reset the view
                });


                 document.getElementById('open-game-setup-btn')?.addEventListener('click', () => { 
                    document.getElementById('game-setup-modal').classList.remove('hidden');
                    toggleScrollLock(true);
                    // Initial setup of content on open
                    document.getElementById('booking-id-entry-container').classList.remove('hidden');
                    document.getElementById('game-setup-content').innerHTML = '';
                 });
                 
                document.getElementById('close-game-setup-btn')?.addEventListener('click', () => { 
                    document.getElementById('game-setup-modal').classList.add('hidden');
                    toggleScrollLock(false);
                    cleanupModal();
                });


            } catch (e) {
                console.error("Error setting up event listeners:", e);
            }
        }

        // Initialize on window load
        window.onload = () => {
            initializeFirebase();
            setupEventListeners();
        };

        // Expose helper functions globally for inline HTML (fallback compatibility)
        window.toggleSlotSelection = toggleSlotSelection;
        window.submitBooking = submitBooking;

    </script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="notification-container"></div>
    <!-- Fixed Header -->
    <header class="sticky top-0 z-40 header-gradient shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <!-- Logo/Branding - FIX: Enlarged icon to w-12 h-12 and decreased text size to text-3xl -->
                    <a href="#hero" class="flex items-center space-x-2 text-3xl font-extrabold text-white">
                        <svg class="w-12 h-12 fill-current text-arena-cyan" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                            <path fill="#06b6d4" d="M10 8V5.41l5.5 5.5-5.5 5.5V13H8v-2h2V8z"/>
                            <circle cx="12" cy="12" r="1.5" fill="#facc15"/>
                        </svg>
                        <!-- Transparent background logo text effect is applied here -->
                        <span class="arena-gradient-text text-3xl">Oxygen Powerplay Arena</span>
                    </a>
                </div>
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-8 font-medium">
                    <a href="#how-it-works" class="hover:text-arena-cyan transition duration-150">How It Works</a>
                    <a href="#activities" class="hover:text-arena-cyan transition duration-150">Amenities</a>
                    <a href="#pricing" class="hover:text-arena-cyan transition duration-150">Rates</a>
                    <a href="#policies" class="hover:text-arena-cyan transition duration-150">Policies</a>
                    <a href="#contact" class="hover:text-arena-cyan transition duration-150">Contact</a>
                    <!-- This is the top right 'BOOK TURF' button -->
                    <button id="open-booking-btn" class="px-4 py-1.5 text-sm font-bold text-white rounded-full bg-arena-gradient shadow-lg hover:shadow-arena-cyan/50 transition-shadow">
                        BOOK TURF
                    </button>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-arena-cyan focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Navigation Menu -->
        <nav id="mobile-menu" class="hidden md:hidden absolute w-full bg-arena-dark shadow-xl pb-4">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col items-center">
                <a href="#how-it-works" onclick="closeMenu()" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-arena-dark-accent">How It Works</a>
                <a href="#activities" onclick="closeMenu()" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-arena-dark-accent">Amenities</a>
                <a href="#pricing" onclick="closeMenu()" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-arena-dark-accent">Rates</a>
                <a href="#policies" onclick="closeMenu()" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-arena-dark-accent">Policies</a>
                <a href="#contact" onclick="closeMenu()" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-arena-dark-accent">Contact</a>
                <!-- Listener is now handled in JS event listener for reliability -->
                <button id="open-booking-btn-mobile" class="mt-4 px-6 py-2 text-sm font-bold text-white rounded-full bg-arena-gradient shadow-lg hover:opacity-90 transition-opacity">
                    BOOK YOUR SESSION
                </button>
            </div>
        </nav>
    </header>

    <main>
        <!-- NEW: "How It Works" Section for User-Friendliness -->
        <section id="how-it-works" class="py-16 md:py-20 bg-arena-dark-accent">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center mb-12 text-white">How It Works: <span class="arena-gradient-text">3 Easy Steps</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    
                    <!-- Step 1: Book -->
                    <div class="flex flex-col items-center">
                        <div class="flex items-center justify-center w-20 h-20 mb-4 bg-arena-cyan rounded-full shadow-lg">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">1. Book Your Slot</h3>
                        <p class="text-gray-400">Click 'Book Turf', pick your date and time slots, and fill in your details.</p>
                    </div>

                    <!-- Step 2: Pay -->
                    <div class="flex flex-col items-center">
                        <div class="flex items-center justify-center w-20 h-20 mb-4 bg-arena-green rounded-full shadow-lg">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H7a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">2. Pay & Confirm</h3>
                        <p class="text-gray-400">Scan the QR code or use the UPI link to pay, then click 'I have Paid' to confirm.</p>
                    </div>

                    <!-- Step 3: Play & Report -->
                    <div class="flex flex-col items-center">
                        <div class="flex items-center justify-center w-20 h-20 mb-4 bg-arena-peak rounded-full shadow-lg">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12 12 0 0012 21.055a12 12 0 008.618-15.04z"></path></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">3. Play & Report</h3>
                        <p class="text-gray-400">After your match, use 'Report Score' with your Booking ID to set team names and share the results.</p>
                    </div>

                </div>
            </div>
        </section>


        <!-- Hero Section - FIX: Changed background to bg-arena-dark to blend with body background -->
        <section id="hero" class="relative overflow-hidden pt-20 pb-20 md:pt-32 md:pb-40 text-center bg-arena-dark">
            <!-- Background Overlay and Effects -->
            <!-- Using a subtle dark overlay to give depth over the dark accent background -->
            <div class="absolute inset-0 z-0 opacity-20 bg-black/50"></div>
            
            <div class="relative z-10 max-w-4xl mx-auto px-4">
                <h1 class="text-5xl md:text-7xl font-extrabold mb-4 leading-tight tracking-tight">
                    <span class="arena-gradient-text">The Ultimate Cricket Experience.</span>
                </h1>
                <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-2xl mx-auto">
                    Book the **Oxygen Powerplay Rooftop Cricket Turf** 24/7. High-performance pitch, unmatched city views, and real-time scorekeeping collaboration.
                </p>
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                    <!-- Changed ID to open-booking-btn-hero to fix multiple-click issue -->
                    <button id="open-booking-btn-hero" class="py-3 px-8 text-lg font-bold text-white rounded-full bg-arena-gradient shadow-xl shadow-arena-cyan/50 hover:shadow-arena-cyan/70 transition-shadow transform hover:scale-105">
                        BOOK YOUR TURF SLOT NOW
                    </button>
                    <button id="open-game-setup-btn" class="py-3 px-8 text-lg font-bold text-white rounded-full bg-red-600 shadow-xl shadow-red-600/50 hover:shadow-red-600/70 transition-shadow transform hover:scale-105">
                        Setup Match / Report Score
                    </button>
                </div>
            </div>
        </section>

        <!-- Activities/Amenities Section -->
        <section id="activities" class="py-16 md:py-24 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-bold text-center mb-12 arena-gradient-text">The Premium Pitch Amenities</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center">
                <!-- Amenity 1: Floodlights -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-arena-peak" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2zM7 11h10"></path></svg>
                    <p class="font-bold text-lg">High-Power Floodlights</p>
                    <p class="text-sm text-gray-400">Night matches, clear visibility.</p>
                </div>
                <!-- Amenity 2: Spectator View -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-arena-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.55-4.55a2 2 0 000-2.83l-1.41-1.41a2 2 0 00-2.83 0L10 6M10 18v-2M15 18v-2M5 18H3a2 2 0 01-2-2v-4a2 2 0 012-2h4a2 2 0 012 2v4a2 2 0 01-2 2H5z"></path></svg>
                    <p class="font-bold text-lg">Spectator Viewing Area</p>
                    <p class="text-sm text-gray-400">Comfortable space for fans.</p>
                </div>
                <!-- Amenity 3: Toilets -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-arena-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354l.353-.353a4 4 0 015.657 0l.707.707a4 4 0 010 5.657L12 18.354 5.283 11.637a4 4 0 010-5.657l.707-.707a4 4 0 015.657 0L12 4.354z"></path></svg>
                    <p class="font-bold text-lg">Toilets & Changing Rooms</p>
                    <p class="text-sm text-gray-400">Clean, dedicated facilities.</p>
                </div>
                <!-- Amenity 4: First Aid -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <p class="font-bold text-lg">On-Site First Aid</p>
                    <p class="text-sm text-gray-400">Safety equipment readily available.</p>
                </div>
                 <!-- Amenity 5: Parking -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <p class="font-bold text-lg">Dedicated Parking</p>
                    <p class="text-sm text-gray-400">Hassle-free vehicle space.</p>
                </div>
                 <!-- Amenity 6: Gear Rental (Mock) -->
                <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl transform hover:scale-105 transition duration-300">
                    <svg class="w-10 h-10 mx-auto mb-3 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    <p class="font-bold text-lg">Gear Support</p>
                    <p class="text-sm text-gray-400">Nets and training equipment.</p>
                </div>
            </div>
        </section>


        <!-- Pricing Section -->
        <section id="pricing" class="py-16 md:py-24 bg-gray-900">
            <h2 class="text-4xl font-bold text-center mb-12 text-white">24/7 Rental Rates</h2>
            <p class="text-center text-gray-400 mb-10 text-lg">Hourly rates for our premium rooftop turf. Minimum 2-hour booking for Late Night slots.</p>

            <div class="max-w-4xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Weekday Pricing -->
                <div class="bg-arena-dark-accent p-8 rounded-xl shadow-2xl border-t-4 border-arena-cyan">
                    <h3 class="text-3xl font-bold text-center mb-6 text-arena-cyan">WEEKDAYS</h3>
                    <ul class="space-y-4">
                        <li class="flex justify-between items-center py-3 border-b border-gray-700">
                            <span class="text-xl font-medium text-gray-300">Early Bird (6 AM - 4 PM)</span>
                            <span class="text-2xl font-extrabold text-arena-green">399/-</span>
                        </li>
                        <li class="flex justify-between items-center py-3 border-b border-gray-700">
                            <span class="text-xl font-medium text-gray-300">Peak Evening (4 PM - 11 PM)</span>
                            <span class="text-2xl font-extrabold text-arena-peak">699/-</span>
                        </li>
                        <li class="flex justify-between items-center py-3">
                            <!-- Fixed to one line with reduced size -->
                            <span class="text-lg font-medium text-gray-300">Late Night / Early Bird (11 PM - 6 AM)</span>
                            <span class="text-2xl font-extrabold text-arena-late">799/-</span>
                        </li>
                    </ul>
                </div>

                <!-- Weekend Pricing -->
                <div class="bg-arena-dark-accent p-8 rounded-xl shadow-2xl border-t-4 border-arena-peak">
                    <h3 class="text-3xl font-bold text-center mb-6 text-arena-peak">WEEKENDS</h3>
                    <ul class="space-y-4">
                        <li class="flex justify-between items-center py-3 border-b border-gray-700">
                            <span class="text-xl font-medium text-gray-300">Early Bird (6 AM - 4 PM)</span>
                            <span class="text-2xl font-extrabold text-arena-green">599/-</span>
                        </li>
                        <li class="flex justify-between items-center py-3 border-b border-gray-700">
                            <span class="text-xl font-medium text-gray-300">Peak Evening (4 PM - 11 PM)</span>
                            <span class="text-2xl font-extrabold text-arena-peak">899/-</span>
                        </li>
                        <li class="flex justify-between items-center py-3">
                            <!-- Fixed to one line with reduced size -->
                            <span class="text-lg font-medium text-gray-300">Late Night / Early Bird (11 PM - 6 AM)</span>
                            <span class="text-2xl font-extrabold text-arena-late">899/-</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Policies Section (Accordion) -->
        <section id="policies" class="py-16 md:py-24 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-bold text-center mb-12 text-white">Policies & Terms</h2>
            
            <div class="space-y-4">
                <!-- Terms and Conditions Accordion -->
                <div class="bg-arena-dark-accent rounded-xl shadow-lg overflow-hidden">
                    <button class="w-full text-left p-5 font-bold text-xl text-arena-cyan flex justify-between items-center" 
                            onclick="document.getElementById('terms-content').classList.toggle('hidden');">
                        Terms and Conditions
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="terms-content" class="hidden p-5 border-t border-gray-700 text-gray-400 space-y-3">
                        <p><strong>1. Usage:</strong> The turf is strictly for cricket and related activities. No outside food, beverages (other than water), or sharp objects are allowed on the turf.</p>
                        <p><strong>2. Attire:</strong> Players must wear appropriate sports attire and non-marking shoes (flat soles). Barefoot or spiked footwear is strictly prohibited.</p>
                        <p><strong>3. Conduct:</strong> Users are responsible for their guests and must maintain respectful conduct. The Arena reserves the right to terminate a session without refund for disruptive behavior.</p>
                        <p><strong>4. Late Night Bookings:</strong> All slots between 11 PM and 6 AM require a minimum booking of 2 consecutive hours.</p>
                    </div>
                </div>

                <!-- Refund Policy Accordion -->
                <div class="bg-arena-dark-accent rounded-xl shadow-lg overflow-hidden">
                    <button class="w-full text-left p-5 font-bold text-xl text-arena-cyan flex justify-between items-center" 
                            onclick="document.getElementById('refund-content').classList.toggle('hidden');">
                        Cancellation & Refund Policy
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="refund-content" class="hidden p-5 border-t border-gray-700 text-gray-400 space-y-3">
                        <p><strong>1. Cancellation Window:</strong> Bookings canceled more than 48 hours in advance will receive a 100% refund as credit for future bookings.</p>
                        <p><strong>2. Partial Refund:</strong> Bookings canceled between 24 and 48 hours in advance are subject to a 50% cancellation fee. The remaining 50% will be issued as credit.</p>
                        <p><strong>3. No Refund:</strong> Cancellations made less than 24 hours prior to the booked slot are not eligible for any refund or credit.</p>
                        <p><strong>4. Weather Policy:</strong> In case of heavy rain or unsafe conditions, the Arena will offer rescheduling or a full credit/refund at the customer's choice.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 md:py-24 bg-gray-900">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <h2 class="text-4xl font-bold mb-6 text-white">Get in Touch</h2>
                <p class="text-gray-400 mb-8 max-w-2xl mx-auto">We're available 24/7 to answer your queries and assist with bookings.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                    <!-- Address -->
                    <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl">
                        <h3 class="text-xl font-bold text-arena-cyan mb-3">Visit Us</h3>
                        <p class="text-gray-300">Oxygen The Muscle Factory (O2),</p>
                        <p class="text-gray-300">3rd floor, 7A, 12th Cross Rd,</p>
                        <p class="text-gray-300">Next to Siddhartha PU college, Lingarajapuram,</p>
                        <p class="text-gray-300">Bengaluru, Karnataka 560084</p>
                    </div>

                    <!-- WhatsApp Contact (Duplicate removed, moved to floating button) -->
                    <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl">
                        <h3 class="text-xl font-bold text-arena-cyan mb-3">WhatsApp Now</h3>
                        <p class="text-3xl font-extrabold text-arena-green mb-4">+91 9019467717</p>
                         <a href="https://wa.me/919019467717?text=Hello%2C%20I%20would%20like%20to%20know%20more%20about%20booking%20the%20rooftop%20cricket%20turf." target="_blank" class="inline-flex items-center justify-center py-2 px-6 bg-arena-gradient rounded-full text-white font-bold hover:opacity-90 transition-opacity">
                            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.14 6.47 2.14 12c0 1.76.47 3.45 1.37 4.96L2 22l6.24-1.63c1.47.8 3.1 1.25 4.02 1.25H4.13A1.9 1.9 0 012.3 20.37V12c0-4.73 3.86-8.6 8.6-8.6 4.73 0 8.6 3.87 8.6 8.6 0 4.73-3.87 8.6-8.6 8.6h-4.04v2.02h4.04c6 0 10.87-4.87 10.87-10.87S18.04 2 12.04 2zM15.42 16.5c-.24 0-.4-.14-.46-.35l-.83-3.08c-.06-.21-.01-.46.1-.64l1.1-1.32c.08-.09.13-.23.08-.34L14.7 10c-.06-.11-.19-.15-.3-.08l-2.02 1.25c-.21.13-.48.16-.7.09l-1.42-.48c-.28-.09-.58-.04-.82.12l-1.3 1.07c-.12.1-.15.26-.06.39l.66 1.02c.05.07.05.17 0 .24l-1.07 1.66c-.1.15-.17.33-.2.52l-.46 1.76c-.05.19-.24.32-.44.27l-.63-.2c-.17-.05-.35-.03-.5.06-1.5 1.05-3.23 1.64-5.06 1.75V12c0-4.4 3.55-8 7.95-8 4.4 0 7.95 3.6 7.95 8s-3.55 8-7.95 8h-.46z"/></svg>
                            Start Chat
                        </a>
                    </div>

                    <!-- Hours -->
                     <div class="bg-arena-dark-accent p-6 rounded-xl shadow-xl">
                        <h3 class="text-xl font-bold text-arena-cyan mb-3">Operating Hours</h3>
                        <p class="text-gray-300 text-3xl font-extrabold mb-2">24 / 7</p>
                        <p class="text-gray-400">Booking available round the clock.</p>
                        <p class="text-gray-400 mt-2 text-sm">Customer support hours may vary for non-booking inquiries.</p>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-arena-dark py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500">
            <p>&copy; 2025 Oxygen Powerplay Arena. All rights reserved.</p>
            <p class="mt-2 text-sm">Built for the love of cricket.</p>
        </div>
    </footer>


    <!-- Floating WhatsApp Support Button (NEW) -->
    <a href="https://wa.me/919019467717?text=Hello%2C%20I%20have%20a%20query%20regarding%20turf%20booking." target="_blank" class="fixed bottom-6 right-6 z-50 p-4 bg-arena-green rounded-full shadow-2xl hover:bg-green-600 transition-colors transform hover:scale-110">
        <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.04 2C6.58 2 2.14 6.47 2.14 12c0 1.76.47 3.45 1.37 4.96L2 22l6.24-1.63c1.47.8 3.1 1.25 4.02 1.25H4.13A1.9 1.9 0 012.3 20.37V12c0-4.73 3.86-8.6 8.6-8.6 4.73 0 8.6 3.87 8.6 8.6 0 4.73-3.87 8.6-8.6 8.6h-4.04v2.02h4.04c6 0 10.87-4.87 10.87-10.87S18.04 2 12.04 2zM15.42 16.5c-.24 0-.4-.14-.46-.35l-.83-3.08c-.06-.21-.01-.46.1-.64l1.1-1.32c.08-.09.13-.23.08-.34L14.7 10c-.06-.11-.19-.15-.3-.08l-2.02 1.25c-.21.13-.48.16-.7.09l-1.42-.48c-.28-.09-.58-.04-.82.12l-1.3 1.07c-.12.1-.15.26-.06.39l.66 1.02c.05.07.05.17 0 .24l-1.07 1.66c-.1.15-.17.33-.2.52l-.46 1.76c-.05.19-.24.32-.44.27l-.63-.2c-.17-.05-.35-.03-.5.06-1.5 1.05-3.23 1.64-5.06 1.75V12c0-4.4 3.55-8 7.95-8 4.4 0 7.95 3.6 7.95 8s-3.55 8-7.95 8h-.46z"/>
        </svg>
    </a>


    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden transition-opacity duration-300 flex items-center justify-center">
        <div class="bg-arena-dark p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto transform scale-100 transition-transform duration-300">
            <!-- Modal Header -->
            <div class="flex justify-between items-center pb-4 border-b border-gray-700">
                <h2 class="text-3xl font-extrabold arena-gradient-text">Book Your Turf Slot</h2>
                <button id="close-booking-btn" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- BOOKING FORM VIEW (Default) -->
            <div id="booking-form-view">
                <form id="booking-form" onsubmit="submitBooking(event)" class="mt-6 space-y-6">
                    
                    <!-- Personal Details & Date -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="col-span-1">
                            <label for="full-name" class="block text-gray-400 font-medium mb-2 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-arena-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                Full Name
                            </label>
                            <input type="text" id="full-name" class="w-full p-3 bg-arena-dark-accent border border-gray-600 rounded-lg text-white placeholder-gray-500" placeholder="Your Name" required>
                        </div>

                        <div class="col-span-1">
                            <label for="phone-number" class="block text-gray-400 font-medium mb-2 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-arena-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.5l1.5 4.5 3-3-4.5-1.5H19a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2v-3.5l4.5-1.5L8.5 12 5 8.5V5z"></path></svg>
                                Phone Number
                            </label>
                            <input type="tel" id="phone-number" class="w-full p-3 bg-arena-dark-accent border border-gray-600 rounded-lg text-white placeholder-gray-500" placeholder="+91 XXXX XXXX XX" required>
                        </div>
                        
                        <div class="col-span-1">
                            <label for="booking-date" class="block text-gray-400 font-medium mb-2 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-arena-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Booking Date
                            </label>
                            <!-- FIX: Date picker indicator is now white via CSS -->
                            <input type="date" id="booking-date" class="w-full p-3 bg-arena-dark-accent border border-gray-600 rounded-lg text-white appearance-none cursor-pointer" required>
                        </div>
                    </div>

                    <!-- Time Slot Grid -->
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4 mt-4">Select Hourly Slots (Continuous)</h3>
                        <!-- FIX: Added col-span-full to the loading message -->
                        <div id="time-slots-grid" class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 xl:grid-cols-12 gap-3">
                            <div class="col-span-full text-center text-arena-cyan font-bold p-4">Initializing Booking System...</div>
                        </div>
                        <p id="booking-error-msg" class="text-red-500 mt-3 text-sm font-semibold h-5"></p>
                    </div>

                    <!-- Summary and Submission -->
                    <div class="flex flex-col sm:flex-row justify-between items-center pt-4 border-t border-gray-700">
                        <div class="text-center sm:text-left mb-4 sm:mb-0">
                            <p class="text-xl text-gray-400">Estimated Total:</p>
                            <p id="total-cost" class="text-4xl font-extrabold arena-gradient-text">0/-</p>
                        </div>
                        <button type="submit" class="py-3 px-12 text-xl font-bold text-white rounded-xl bg-arena-gradient hover:opacity-90 transition-opacity transform hover:scale-105 shadow-lg shadow-arena-cyan/50">
                            CONFIRM BOOKING & PAY
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- NEW: BOOKING PAYMENT VIEW (Hidden by default) -->
            <div id="booking-payment-view" class="hidden text-center py-10 px-4">
                <h3 class="text-4xl font-extrabold text-white mb-4 arena-gradient-text">Payment Due</h3>
                <p class="text-xl text-gray-300 mb-2">Please complete the payment below to confirm your session.</p>
                
                <p class="text-lg text-gray-400 font-mono mb-6">
                    Booking ID: <span id="payment-booking-id" class="text-arena-peak font-bold">---</span>
                </p>

                <p class="text-2xl font-bold mb-4">
                    Total Amount Due: <span id="payment-total-cost" class="text-arena-green text-3xl">---</span>
                </p>

                <div class="bg-arena-dark-accent p-6 rounded-xl inline-block shadow-2xl mb-6">
                    <img src="https://placehold.co/300x300/10b981/ffffff?text=SCAN+TO+PAY" 
                         alt="UPI Payment QR Code Placeholder" 
                         class="w-48 h-48 mx-auto border-4 border-white rounded-lg mb-4">
                    <p class="text-base text-gray-400">
                        <span class="font-bold text-white">UPI ID:</span> oxygenarena@upi
                    </p>
                </div>
                
                <p class="text-sm text-red-400 mb-6">Important: Use the Booking ID as a reference number in your payment app (optional).</p>

                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <!-- Mobile Deep Link Button -->
                    <a id="upi-deep-link" href="#" class="py-3 px-6 text-lg font-bold text-white rounded-xl bg-arena-green hover:bg-green-700 transition-colors transform hover:scale-105 inline-block">
                        Pay ₹<span id="payment-amount-display">---</span> via UPI App
                    </a>
                    <!-- Manual Confirmation Button -->
                    <button id="payment-done-btn" class="py-3 px-6 text-lg font-bold text-white rounded-xl bg-arena-cyan hover:bg-cyan-600 transition-colors transform hover:scale-105">
                        I have Paid (Confirm)
                    </button>
                </div>
            </div>

            
            <!-- BOOKING SUCCESS VIEW (Hidden by default) -->
            <div id="booking-success-view" class="hidden text-center py-10 px-4">
                <svg class="w-16 h-16 mx-auto mb-6 text-arena-green" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h3 class="text-4xl font-extrabold text-white mb-4">Booking Successful!</h3>
                <p class="text-xl text-gray-300 mb-2">Your rooftop session is confirmed.</p>
                <p class="text-lg text-gray-400 font-mono mb-6">
                    Booking ID: <span id="success-booking-id" class="text-arena-peak font-bold">---</span>
                </p>
                <p class="text-2xl font-bold mb-8">
                    Total Paid: <span id="success-total-cost" class="arena-gradient-text">---</span>
                </p>
                <button id="close-success-btn" class="py-3 px-8 text-lg font-bold text-white rounded-full bg-arena-green hover:bg-green-700 transition-colors transform hover:scale-105">
                    Great! Close and Continue
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Setup Modal -->
    <div id="game-setup-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden transition-opacity duration-300 flex items-center justify-center">
        <div class="bg-arena-dark p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform scale-100 transition-transform duration-300">
            <!-- Modal Header -->
            <div class="flex justify-between items-center pb-4 border-b border-gray-700">
                <h2 class="text-3xl font-extrabold arena-gradient-text">Match Scorecard</h2>
                <button id="close-game-setup-btn" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Booking ID Input Form (Contained for hiding) -->
            <form id="game-setup-form" onsubmit="handleGameSetup(event)" class="mt-6 space-y-4">
                <div id="booking-id-entry-container">
                    <h3 class="text-xl font-bold text-white mb-4">Match Setup / Report Score</h3>
                    <p class="text-gray-400 mb-6">Enter your Booking ID to continue.</p>
                    <label for="booking-id-input" class="block text-gray-400 font-medium mb-2">Enter Booking ID</label>
                    <div class="flex space-x-3">
                        <input type="text" id="booking-id-input" class="flex-grow p-3 bg-arena-dark-accent border border-gray-600 rounded-lg text-white placeholder-gray-500" placeholder="Paste your Booking ID here" required>
                        <button type="submit" class="py-2 px-6 text-sm font-bold text-white rounded-lg bg-arena-cyan hover:opacity-90 transition-opacity">
                            Check
                        </button>
                    </div>
                </div>
                <p id="game-error-msg" class="text-red-500 text-sm font-semibold h-5"></p>
            </form>
            
            <!-- Dynamic Content Area -->
            <div id="game-setup-content" class="mt-8">
                <!-- Team Setup or Winner Submission will be injected here by JavaScript -->
            </div>
            
        </div>
    </div>
</body>
</html>
